From 8426f34c8686efc2b35a2bd7374ce4d883ef4d50 Mon Sep 17 00:00:00 2001
From: Vinu Vaghasia <vinu.vaghasia@amd.com>
Date: Fri, 13 Aug 2021 08:58:41 -0500
Subject: [PATCH 1/1] amd-yaap: Add Jtag initialization for coolreset

Signed-off-by: Vinu Vaghasia <vinu.vaghasia@amd.com>
---
 Source/Linux/bmc/hw/jtag_hw.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/Source/Linux/bmc/hw/jtag_hw.cpp b/Source/Linux/bmc/hw/jtag_hw.cpp
index 2797504..ef8597e 100644
--- a/Source/Linux/bmc/hw/jtag_hw.cpp
+++ b/Source/Linux/bmc/hw/jtag_hw.cpp
@@ -103,6 +103,11 @@ void bmc::JtagHw::coolreset()
     FILE *file;
     enum yaap::hal::jtagOp op;

+    // Enable jtag mux
+    setGPIOValue(hdtSelName, 1);
+    // Reset Tap State
+    tapStateSet(yaap::hal::JTAG_STATE_TLR);
+
     file = fopen("/etc/amd-yaap/coolreset.txt", "r");
     while(!feof(file))
     {
@@ -122,9 +127,10 @@ void bmc::JtagHw::coolreset()
       memset (&outData[0], 0, COOL_RESET_MAX_SIZE);
     }

+    // Release Jtag mux
+    setGPIOValue(hdtSelName, 0);
 }

-
 bmc::JtagHw::JtagHw(int driver)
     : m_freq(8250000), m_state(yaap::hal::JTAG_STATE_TLR)
 {
--
2.17.1

