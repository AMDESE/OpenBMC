From dd5323200807af867d2a1ef9c675c2b9161ffde7 Mon Sep 17 00:00:00 2001
From: Mohsen Dolaty <mohsen.dolaty@amd.com>
Date: Tue, 18 Jan 2022 14:49:23 -0600
Subject: [PATCH 1/1] phosphor-network: Delete LCD extra char

Replace LCD extra charachters with space (0x20)

Signed-off-by: Mohsen Dolaty <mohsen.dolaty@amd.com>
---
 ipaddress.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/ipaddress.cpp b/ipaddress.cpp
index 80cacfd..365ceca 100644
--- a/ipaddress.cpp
+++ b/ipaddress.cpp
@@ -25,10 +25,15 @@ using Reason = xyz::openbmc_project::Common::NotAllowed::REASON;

 static void writeLCD(char *ip)
 {
+    int size;
+
     if (lcdlib_open_dev() != 0 ) {
         log<level::ERR>("writeLCD Error: Could not open LCD device\n");
         return;
     }
+    size = strlen(ip);
+    if((size != 0) && (size <= LCD_MAX_CHAR))
+        memset(&ip[size-1], 0x20, (LCD_MAX_CHAR-size+1)); // fill it up with space char
     if (lcdlib_write_string(BMC_IPADDR, (unsigned char*)ip, LCD_MAX_CHAR) !=0)
         log<level::ERR>("writeLCD Error: Could not wirte BMC IP to LCD \n");
     if (lcdlib_close_dev() != 0 )
@@ -54,7 +59,7 @@ IPAddress::IPAddress(sdbusplus::bus::bus& bus, const char* objPath,
     snprintf(ip, LCD_BUFF_SIZE, "%s", address().c_str());
     // skip IPV6
     if (strstr(ip,":") == 0) {
-        snprintf(ip, LCD_BUFF_SIZE, "IP: %s    ", address().c_str());
+        snprintf(ip, LCD_BUFF_SIZE, "IP: %s \n", address().c_str());
         writeLCD(ip);
     }

--
2.25.1
