From ef739743ca9c1d9ad34dc9ea665018189a464e52 Mon Sep 17 00:00:00 2001
From: Rajaganesh Rathinasabapathi <Rajaganesh.Rathinasabapathi@amd.com>
Date: Mon, 20 Sep 2021 11:46:11 -0500
Subject: [PATCH] ARM dts aspeed add memory region to LPC PCC for sp5

---
 arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts     | 16 ++++++----------
 arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts   | 15 ++++++---------
 arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts     | 15 ++++++---------
 arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts | 15 ++++++---------
 4 files changed, 24 insertions(+), 37 deletions(-)

diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts b/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
index d9c8e00deaba..9898434161aa 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
@@ -49,8 +49,12 @@
 			compatible = "shared-dma-pool";
 			reusable;
 		};
-	};

+		pcc_memory: pccbuffer {
+			no-map;
+			reg = <0xE0000000 0x00000010>; /* 16 Bytes */
+		};
+	};
 };

 &mdio0 {
@@ -629,16 +633,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_espi_default &pinctrl_espialt_default>;

-	perif,memcyc-src-addr = <0x98000000>;
-	perif,memcyc-size = <0x10000>;
 	perif,dma-mode;
-
-	oob,dma-mode;
-	oob,dma-tx-desc-num = <0x2>;
-	oob,dma-rx-desc-num = <0x8>;
-
-	flash,dma-mode;
-	flash,safs-mode = <0x2>;
 };

 &espi_mmbi {
@@ -700,6 +695,7 @@
 &lpc_pcc {
 	port-addr = <0x80>;
 	dma-mode;
+	memory-region = <&pcc_memory>;
 	status = "okay";
 };

diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts b/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
index a450d969a0a3..4a5a18982a40 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
@@ -48,6 +48,11 @@
 			compatible = "shared-dma-pool";
 			reusable;
 		};
+
+		pcc_memory: pccbuffer {
+			no-map;
+			reg = <0xE0000000 0x00000010>; /* 16 Bytes */
+		};
 	};

 };
@@ -749,16 +754,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_espi_default &pinctrl_espialt_default>;

-	perif,memcyc-src-addr = <0x98000000>;
-	perif,memcyc-size = <0x10000>;
 	perif,dma-mode;
-
-	oob,dma-mode;
-	oob,dma-tx-desc-num = <0x2>;
-	oob,dma-rx-desc-num = <0x8>;
-
-	flash,dma-mode;
-	flash,safs-mode = <0x2>;
 };

 &espi_mmbi {
@@ -820,6 +816,7 @@
 &lpc_pcc {
 	port-addr = <0x80>;
 	dma-mode;
+	memory-region = <&pcc_memory>;
 	status = "okay";
 };

diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts b/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
index 85e296c38f9a..8a77e990c478 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
@@ -48,6 +48,11 @@
 			compatible = "shared-dma-pool";
 			reusable;
 		};
+
+		pcc_memory: pccbuffer {
+			no-map;
+			reg = <0xE0000000 0x00000010>; /* 16 Bytes */
+		};
 	};

 };
@@ -357,16 +362,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_espi_default &pinctrl_espialt_default>;

-	perif,memcyc-src-addr = <0x98000000>;
-	perif,memcyc-size = <0x10000>;
 	perif,dma-mode;
-
-	oob,dma-mode;
-	oob,dma-tx-desc-num = <0x2>;
-	oob,dma-rx-desc-num = <0x8>;
-
-	flash,dma-mode;
-	flash,safs-mode = <0x2>;
 };

 &espi_mmbi {
@@ -428,6 +424,7 @@
 &lpc_pcc {
 	port-addr = <0x80>;
 	dma-mode;
+	memory-region = <&pcc_memory>;
 	status = "okay";
 };

diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts b/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
index 3daeae16da35..dc7f58b8cc21 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
@@ -36,6 +36,11 @@
 			compatible = "shared-dma-pool";
 			reusable;
 		};
+
+		pcc_memory: pccbuffer {
+			no-map;
+			reg = <0xE0000000 0x00000010>; /* 16 Bytes */
+		};
 	};

 };
@@ -335,16 +340,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_espi_default &pinctrl_espialt_default>;

-	perif,memcyc-src-addr = <0x98000000>;
-	perif,memcyc-size = <0x10000>;
 	perif,dma-mode;
-
-	oob,dma-mode;
-	oob,dma-tx-desc-num = <0x2>;
-	oob,dma-rx-desc-num = <0x8>;
-
-	flash,dma-mode;
-	flash,safs-mode = <0x2>;
 };

 &espi_mmbi {
@@ -409,6 +405,7 @@
 &lpc_pcc {
 	port-addr = <0x80>;
 	dma-mode;
+	memory-region = <&pcc_memory>;
 	status = "okay";
 };

--
2.17.1

