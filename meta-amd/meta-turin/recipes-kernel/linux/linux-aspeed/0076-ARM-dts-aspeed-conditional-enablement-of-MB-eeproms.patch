From 5455a1de77f103acdb492180daa9edb02df87f77 Mon Sep 17 00:00:00 2001
From: Vinu Vaghasia <vinu.vaghasia@amd.com>
Date: Fri, 4 Feb 2022 11:48:01 -0600
Subject: [PATCH 1/1] ARM:dts:aspeed: conditional enablement of MB eeproms

Signed-off-by: Rajaganesh Rathinasabapathi <Rajaganesh.Rathinasabapathi@amd.com
---
 arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts     |  3 ++-
 arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts   |  3 ++-
 arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts     |  3 ++-
 arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts | 26 +++++++++++++------
 4 files changed, 24 insertions(+), 11 deletions(-)

diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts b/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
index 0453d946e6dd..97ed24d8fa6d 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-onyx.dts
@@ -247,6 +247,7 @@
 	// Net name i2c7
 	status = "okay";

+#ifdef EEPROM_PROG_ENABLE
 	i2cswitch@70 {
 		compatible = "nxp,pca9548";
 		reg = <0x70>;
@@ -278,7 +279,7 @@
 		};

 	};
-
+#endif
 };

 &i2c11 {
diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts b/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
index a0e01645593b..5431de818ac6 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-quartz.dts
@@ -589,6 +589,7 @@
 	// Net name i2c7 (SCM_I2C7)
 	status = "okay";

+#ifdef EEPROM_PROG_ENABLE
 	i2cswitch@70 {
 		compatible = "nxp,pca9548";
 		reg = <0x70>;
@@ -642,7 +643,7 @@
 		compatible = "nxp,pca9546";
 		reg = <0x70>;
 	};
-
+#endif
 };

 &i2c11 {
diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts b/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
index 3be7877e1058..a7166512268f 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-ruby.dts
@@ -380,7 +380,7 @@
 &i2c10 {
 	// Net name i2c7
 	status = "okay";
-
+#ifdef EEPROM_PROG_ENABLE
 	// UBM
 	i2cswitch@70 {
 		compatible = "nxp,pca9548";
@@ -411,6 +411,7 @@
 			};
 		};
 	};
+#endif
 };

 // BCM5720 LOM
diff --git a/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts b/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
index 5610df002bb0..501b01a441be 100644
--- a/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
+++ b/arch/arm/boot/dts/aspeed-bmc-amd-titanite.dts
@@ -746,11 +746,11 @@
 &i2c10 {
 	// Net name i2c7
 	status = "okay";
-
+#ifdef EEPROM_PROG_ENABLE
 	// SCM brd_id, Titanite brd_id, CLK
-	i2cswitch@70 {
-		compatible = "nxp,pca9548";
-		reg = <0x70>;
+	i2cswitch@71 {
+		compatible = "nxp,pca9848";
+		reg = <0x71>;
 		#address-cells = <1>;
 		#size-cells = <0>;

@@ -769,14 +769,24 @@
 				compatible = "microchip,24lc256","atmel,24c256";
 				reg = <0x51>;
 			};
+
+			// Usually the eeproms are at 0x50 and 0x51 address,
+			// but some systems (Rev A) have eeprom address 0x54
+			// SCM BRD ID eeprom
+			scmbrdeeprom@54 {
+				compatible = "microchip,24lc256","atmel,24c256";
+				reg = <0x54>;
+			};
 		};
 	};
-
 	// Midpalne, Raiser cards, SATA, etc
-	i2cswitch@71 {
-		compatible = "nxp,pca9548";
-		reg = <0x71>;
+	i2cswitch@75 {
+		compatible = "nxp,pca9848";
+		reg = <0x75>;
+		#address-cells = <1>;
+		#size-cells = <0>;
 	};
+#endif
 };

 // 1G ROM
--
2.17.1

